build:
  system_packages:
    - "python3-pip"
    - "build-essential"
    - "git"
    - "yasm"
    - "nasm"
    - "cmake"
    - "libtool"
    - "libc6"
    - "libc6-dev"
    - "unzip"
    - "wget"
    - "libnuma1"
    - "libnuma-dev"
    - "pkg-config"
    - "libavcodec-dev"
    - "libavdevice-dev"
    - "libavfilter-dev"
    - "libavformat-dev"
    - "libavutil-dev"
    - "libswresample-dev"
    - "libswscale-dev"
    - "libcpu-features-dev"
  python_packages:
    - "fastapi==0.101.0"
    - "pydantic==2.1.1"
    - "pydantic_core==2.4.0"
    - "urllib3==2.0.4"
    - "uvicorn==0.23.2"
    - "torch==2.5.1"
    - "boto3"
    - "accelerate"
  run:
    - "mkdir -p /var/nvidia/ && cd /var/nvidia/ && git clone https://git.videolan.org/git/ffmpeg/nv-codec-headers.git nv-codec-headers && cd nv-codec-headers && make install"
    - "cd /var/nvidia/ && git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg/ && cd ffmpeg/ && ./configure --enable-nonfree --enable-cuda-nvcc --enable-libnpp --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64 && make -j $(nproc) && make install"
